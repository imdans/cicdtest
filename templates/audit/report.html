{% extends 'base.html' %}
{% block title %}Audit Report{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto;">
    <h1 class="card-header" style="margin-bottom: 2rem;">Audit Report</h1>
    
    <!-- Report Summary -->
    <div class="card" style="margin-bottom: 2rem;">
        <h2 style="color: var(--silver); font-size: 1.25rem; margin-bottom: 1rem;">Report Summary</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
            <div>
                <p style="color: var(--light-grey); margin-bottom: 0.25rem;">Report Period</p>
                <p style="color: var(--silver); font-size: 1.1rem;">{{ start_date }} to {{ end_date }}</p>
            </div>
            <div>
                <p style="color: var(--light-grey); margin-bottom: 0.25rem;">Total Events</p>
                <p style="color: var(--silver); font-size: 1.1rem;">{{ total_events or 0 }}</p>
            </div>
            <div>
                <p style="color: var(--light-grey); margin-bottom: 0.25rem;">Unique Users</p>
                <p style="color: var(--silver); font-size: 1.1rem;">{{ unique_users or 0 }}</p>
            </div>
            <div>
                <p style="color: var(--light-grey); margin-bottom: 0.25rem;">Report Generated</p>
                <p style="color: var(--silver); font-size: 1.1rem;">{{ generated_at }}</p>
            </div>
        </div>
    </div>
    
    <!-- Event Type Breakdown -->
    <div class="card" style="margin-bottom: 2rem;">
        <h2 style="color: var(--silver); font-size: 1.25rem; margin-bottom: 1rem;">Event Type Distribution</h2>
        <table style="width: 100%;">
            <thead>
                <tr>
                    <th>Event Type</th>
                    <th style="text-align: right;">Count</th>
                    <th style="text-align: right;">Percentage</th>
                </tr>
            </thead>
            <tbody>
                {% for event in event_types %}
                <tr>
                    <td style="color: var(--silver);">{{ event.type }}</td>
                    <td style="text-align: right; color: var(--silver);">{{ event.count }}</td>
                    <td style="text-align: right; color: var(--silver);">{{ event.percentage }}%</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="3" style="text-align: center; color: var(--light-grey); padding: 2rem;">
                        No events recorded in this period
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- User Activity -->
    <div class="card" style="margin-bottom: 2rem;">
        <h2 style="color: var(--silver); font-size: 1.25rem; margin-bottom: 1rem;">Top User Activity</h2>
        <table style="width: 100%;">
            <thead>
                <tr>
                    <th>User</th>
                    <th style="text-align: right;">Actions</th>
                    <th style="text-align: right;">Last Activity</th>
                </tr>
            </thead>
            <tbody>
                {% for user in top_users %}
                <tr>
                    <td style="color: var(--silver);">{{ user.name }}</td>
                    <td style="text-align: right; color: var(--silver);">{{ user.action_count }}</td>
                    <td style="text-align: right; color: var(--silver);">{{ user.last_activity }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="3" style="text-align: center; color: var(--light-grey); padding: 2rem;">
                        No user activity recorded
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Recent Events -->
    <div class="card">
        <h2 style="color: var(--silver); font-size: 1.25rem; margin-bottom: 1rem;">Recent Events</h2>
        <table style="width: 100%;">
            <thead>
                <tr>
                    <th>Timestamp</th>
                    <th>User</th>
                    <th>Event Type</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                {% for event in recent_events %}
                <tr>
                    <td style="color: var(--light-grey); font-size: 0.9rem;">{{ event.timestamp }}</td>
                    <td style="color: var(--silver);">{{ event.user }}</td>
                    <td><span class="badge badge-secondary">{{ event.type }}</span></td>
                    <td style="color: var(--silver);">{{ event.description }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="4" style="text-align: center; color: var(--light-grey); padding: 2rem;">
                        No recent events
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Export Options -->
    <div style="margin-top: 2rem; display: flex; gap: 1rem;">
        <a href="{{ url_for('audit.export_report', format='pdf') }}" class="btn btn-primary">Export as PDF</a>
        <a href="{{ url_for('audit.export_report', format='csv') }}" class="btn btn-secondary">Export as CSV</a>
    </div>
</div>
{% endblock %}
